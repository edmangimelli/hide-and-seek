<!DOCTYPE html>
<head>
	<meta charset="utf-8">
	<style>
		body {text-align: center; font-size: 15px; font-family: sans-serif}
		input {font-size: 15px; font-family: sans-serif;}
		button {font-size: 15px; font-family: sans-serif;}
	</style>
</head>
<body>
</body>
<script>
	mainScreen();

	var socket = new WebSocket("ws://localhost:8080/socket");

	socket.onopen = function () {
		console.log("connected.");
	};

	socket.onmessage = function (e) {
		console.log("received message:")
		console.log(e.data)

		let body = document.getElementsByTagName("body")[0];

		switch (e.data) {
		case "error\nno such game":
			enterCode();
			println("Can't find that game. ðŸ˜•", "Is that the right code?");
			break
		case "error\nname is taken":
			mainScreen();
			println("That name is taken. ðŸ˜•", "Try a different name!);
			break
		case "game is in session\nwill send message when next round starts":
			println("You'll join at the next round!");
			break
		case "game hasn't started\nwill send messages as players join and when the first round starts":
			println("The seeker has not", "started the game yet.", "Hold tight!");
			break
		case "error\ntoo many games currently in session":
			println("Whoa!", "The server can't handle", "any more games!", "Try again later", "or join a game.");
			break
		case "game has started":
			gameScreen(); // this needs to be fixed (also we need much more in the message)
			break
		default:
			e = e.data.split("\n")
			if (e[0] == "error" && e[1] == "no such game") {
				println();
			}
			//"game initialized\n%s\nwill send messages as players join\nmust receive signal to start game"
			//"joined\n%s"
			break
		}
	};


	function mainScreen() {
		let body = document.getElementsByTagName("body")[0];
		body.innerHTML = "";
		body.appendChild(document.createTextNode("name: "))
		let input = document.createElement("input")
		input.setAttribute("id", "name")
		input.setAttribute("style", "width: 150px;")
		input.setAttribute("maxlength", "31")
		body.appendChild(input)
		body.appendChild(document.createElement("br"))
		body.appendChild(document.createElement("br"))
		let button = document.createElement("button")
		button.setAttribute("onclick", "newGame()")
		button.appendChild(document.createTextNode("Start New Game"))
		body.appendChild(button)
		body.appendChild(document.createElement("br"))
		let em = document.createElement("em")
		em.appendChild(document.createTextNode("or"))
		body.appendChild(em)
		body.appendChild(document.createElement("br"))
		button = document.createElement("button")
		button.setAttribute("onclick", "enterCode()")
		button.appendChild(document.createTextNode("Join a Game"))
		body.appendChild(button)
		body.appendChild(document.createElement("br"))
		body.appendChild(document.createElement("br"))
	}
	
	function enterCode() {
		let name = document.getElementById("name").value
		let body = document.getElementsByTagName("body")[0];
		body.innerHTML = "";
		body.appendChild(document.createTextNode("code: "))
		let input = document.createElement("input")
		input.setAttribute("id", "code")
		input.setAttribute("style", "width: 150px;")
		input.setAttribute("maxlength", "4")
		body.appendChild(input)
		input = document.createElement("input")
		input.setAttribute("id", "name")
		input.setAttribute("type", "hidden")
		input.setAttribute("value", name)
		body.appendChild(input)
		body.appendChild(document.createElement("br"))
		body.appendChild(document.createElement("br"))
		let button = document.createElement("button")
		button.setAttribute("onclick", "joinGame()")
		button.appendChild(document.createTextNode("join"))
		body.appendChild(button)
		body.appendChild(document.createElement("br"))
		body.appendChild(document.createElement("br"))
	}

	function newGame() {
		sendMsg("new game", document.getElementById("name").value);
	}

	function joinGame() {
		sendMsg("join",
			document.getElementById("code").value,
			document.getElementById("name").value)
	}

	function sendMsg() {
		let msg = Array.from(arguments).join("\n")
		socket.send(msg)
		console.log("message sent:")
		console.log(msg)
	}

	function println() {
		let body = document.getElementsByTagName("body")[0];
		for (let text of Array.from(arguments)) {
			body.appendChild(document.createTextNode(text));
			body.appendChild(document.createElement("br"));
		}
	}
</script>

